<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易家計簿</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: auto; }
        input, button { display: block; margin: 10px 0; width: 100%; padding: 8px; }
        .entry { border-bottom: 1px solid #ccc; padding: 10px 0; }
    </style>
</head>
<body>
    <h2>給料 & 支出管理</h2>
    <label>給料:</label>
    <input type="number" id="salary" placeholder="給料を入力">
    
    <h3>支出カテゴリ</h3>
    <div id="expenseCategories"></div>
    <input type="text" id="newCategory" placeholder="カテゴリ名を入力">
    <button onclick="addCategory()">カテゴリ追加</button>
    
    <button onclick="calculateBalance()">計算して保存</button>
    <h3>残高: <span id="balance">0</span> 円</h3>
    
    <h3>過去の記録</h3>
    <div id="history"></div>

    <script>
        function addCategory() {
            const categoryName = document.getElementById('newCategory').value.trim();
            if (!categoryName) return;
            
            let categories = JSON.parse(localStorage.getItem('categories')) || [];
            if (!categories.includes(categoryName)) {
                categories.push(categoryName);
                localStorage.setItem('categories', JSON.stringify(categories));
            }
            displayCategories();
        }
        
        function displayCategories() {
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const container = document.getElementById('expenseCategories');
            container.innerHTML = '';
            categories.forEach(category => {
                const label = document.createElement('label');
                label.innerText = category;
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `expense-${category}`;
                input.placeholder = `${category}を入力`;
                container.appendChild(label);
                container.appendChild(input);
            });
        }
        
        function calculateBalance() {
            const salary = Number(document.getElementById('salary').value) || 0;
            
            let totalExpense = 0;
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const expenses = {};
            categories.forEach(category => {
                const value = Number(document.getElementById(`expense-${category}`).value) || 0;
                expenses[category] = value;
                totalExpense += value;
            });
            
            const balance = salary - totalExpense;
            document.getElementById('balance').innerText = balance + ' 円';
            
            const entry = { date: new Date().toLocaleDateString(), salary, expenses, balance };
            
            let history = JSON.parse(localStorage.getItem('history')) || [];
            history.unshift(entry);
            localStorage.setItem('history', JSON.stringify(history));
            
            displayHistory();
        }

        function displayHistory() {
            const history = JSON.parse(localStorage.getItem('history')) || [];
            const historyDiv = document.getElementById('history');
            historyDiv.innerHTML = '';
            history.forEach(entry => {
                const div = document.createElement('div');
                div.classList.add('entry');
                let expensesText = Object.entries(entry.expenses).map(([key, value]) => `${key}: ${value} 円`).join(', ');
                div.innerHTML = `<strong>${entry.date}</strong> - 残高: ${entry.balance} 円<br>${expensesText}`;
                historyDiv.appendChild(div);
            });
        }

        displayCategories();
        displayHistory();
    </script>
</body>
</html>
